<?xml version="1.0" encoding="utf-8"?>
<modification>
  <name>HP Sub Total Taxable and Non Taxable</name>
  <code>HPSTTNT</code>
  <version>1.0.0.0</version>
  <author>HP Web Design</author>
  <link>https://hpwebdesign.io</link>
  
  <file path="catalog/model/extension/total/sub_total.php">
     <operation error="skip">
      <search trim="true"><![CDATA[$sub_total = $this->cart->getSubTotal();]]></search>
      <add position="before"><![CDATA[
        $sub_total_non_tax = $this->cart->getSubTotalNonTax();
        $sub_total_tax     = $this->cart->getSubTotalTax();
        
        $text_parts = [];
        
        if ($sub_total_tax > 0) {
            $text_parts[] = "Taxable : " . $this->currency->format($sub_total_tax,$this->session->data['currency']);
        }
        
        if ($sub_total_non_tax > 0) {
            $text_parts[] = "Non Taxable : " . $this->currency->format($sub_total_non_tax,$this->session->data['currency']);
        }
        
        $text = '';
        if (!empty($text_parts)) {
            $text = " (" . implode(" | ", $text_parts) . ")";
        }
      
      ]]></add>
    </operation>
    <operation error="skip">
      <search trim="true"><![CDATA[$this->language->get('text_sub_total')]]></search>
      <add position="replace"><![CDATA[$this->language->get('text_sub_total').$text]]></add>
    </operation>
  </file>
  <file path="system/library/cart/cart.php">
    <operation error="skip">
      <search trim="true"><![CDATA[public function getSubTotal() {]]></search>
      <add position="before"><![CDATA[
      public function getSubTotalTax() {
        $total = 0;

        foreach ($this->getProducts() as $product) {
            if ($product['tax_class_id']) {
                $total += $product['total'];
            }
        }

        return $total;
      }
        public function getSubTotalNonTax() {
            $total = 0;

            foreach ($this->getProducts() as $product) {
                if (!$product['tax_class_id']) {
                    $total += $product['total'];
                }
            }

            return $total;
        }

      ]]></add>
    </operation>
  </file>
  
</modification>